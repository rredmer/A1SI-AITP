# Docker Compose for Crypto-Investor Platform
# Run: docker-compose up -d
# Profiles: research, trading, monitoring

version: "3.9"

services:
  # ──────────────────────────────────────────────
  # Redis — State persistence for NautilusTrader
  # ──────────────────────────────────────────────
  redis:
    image: redis:7-alpine
    container_name: ci-redis
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    command: redis-server --appendonly yes
    restart: unless-stopped
    profiles: ["trading", "full"]

  # ──────────────────────────────────────────────
  # Freqtrade — Crypto Trading Engine
  # ──────────────────────────────────────────────
  freqtrade:
    image: freqtradeorg/freqtrade:stable
    container_name: ci-freqtrade
    volumes:
      - ./freqtrade/user_data:/freqtrade/user_data
      - ./freqtrade/config.json:/freqtrade/config.json
      - ./data/processed:/freqtrade/data
      - ./common:/freqtrade/common
    ports:
      - "8080:8080"  # API/WebUI
    command: trade --config /freqtrade/config.json --strategy CryptoInvestorV1 --strategy-path /freqtrade/user_data/strategies
    environment:
      - BINANCE_API_KEY=${BINANCE_API_KEY:-}
      - BINANCE_SECRET=${BINANCE_SECRET:-}
      - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN:-}
      - TELEGRAM_CHAT_ID=${TELEGRAM_CHAT_ID:-}
    restart: unless-stopped
    profiles: ["trading", "full"]

  # ──────────────────────────────────────────────
  # Jupyter — Research Environment
  # ──────────────────────────────────────────────
  jupyter:
    image: jupyter/scipy-notebook:latest
    container_name: ci-jupyter
    volumes:
      - ./research:/home/jovyan/research
      - ./data:/home/jovyan/data
      - ./common:/home/jovyan/common
    ports:
      - "8888:8888"
    environment:
      - JUPYTER_ENABLE_LAB=yes
    command: start-notebook.sh --NotebookApp.token='crypto-investor'
    profiles: ["research", "full"]

  # ──────────────────────────────────────────────
  # Dashboard — Monitoring (Streamlit)
  # ──────────────────────────────────────────────
  dashboard:
    build:
      context: .
      dockerfile: Dockerfile.dashboard
    container_name: ci-dashboard
    volumes:
      - ./dashboard:/app
      - ./data:/app/data
      - ./logs:/app/logs
    ports:
      - "8501:8501"
    restart: unless-stopped
    profiles: ["monitoring", "full"]

volumes:
  redis_data:
